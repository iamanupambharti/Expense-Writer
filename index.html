<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Expense Widget - AI</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { background-color: #f3f4f6; font-family: sans-serif; user-select: none; }
        .excel-grid { border-collapse: collapse; width: 100%; }
        .excel-grid th, .excel-grid td { border: 1px solid #e5e7eb; padding: 8px 12px; text-align: left; }
        .excel-grid th { background-color: #f9fafb; font-weight: 600; color: #374151; }
        .excel-grid tr:hover { background-color: #f0fdf4; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .prose h1, .prose h2 { font-weight: bold; margin-bottom: 0.5em; }
        .prose ul { list-style: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .sparkle-btn { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .listening-pulse { animation: pulse-red 1.5s infinite; }
        
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const ExpenseTracker = () => {
            const [expenses, setExpenses] = useState([]);
            const [locations, setLocations] = useState(['Home', 'Office', 'Online', 'Travel']);
            const [isWidgetMode, setIsWidgetMode] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [showAnalysis, setShowAnalysis] = useState(false);
            const [userApiKey, setUserApiKey] = useState("AIzaSyARzEF3VyFD4zhw9QNesicI_tzJpHVIoEE");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [analysisResult, setAnalysisResult] = useState("");
            const [currencySymbol, setCurrencySymbol] = useState('$');
            const [formData, setFormData] = useState({ name: '', amount: '', date: new Date().toISOString().split('T')[0], location: 'Home' });
            const [notification, setNotification] = useState(null);
            const [newLocationInput, setNewLocationInput] = useState("");

            const [showSmartAdd, setShowSmartAdd] = useState(false);
            const [smartInput, setSmartInput] = useState("");
            const [isListening, setIsListening] = useState(false);
            
            const recognitionRef = useRef(null);

            useEffect(() => {
                try {
                    const savedData = localStorage.getItem('my_excel_expenses');
                    const savedLocs = localStorage.getItem('my_expense_locations');
                    const savedCurr = localStorage.getItem('my_expense_currency');
                    const savedKey = localStorage.getItem('my_gemini_api_key');
                    
                    if (savedData) setExpenses(JSON.parse(savedData));
                    if (savedLocs) setLocations(JSON.parse(savedLocs));
                    if (savedCurr) setCurrencySymbol(savedCurr);
                    if (savedKey && savedKey.length > 10) setUserApiKey(savedKey);
                } catch (e) {
                    console.error("Error loading local storage:", e);
                    showNotify("Error loading saved data.");
                }
            }, []);

            useEffect(() => localStorage.setItem('my_excel_expenses', JSON.stringify(expenses)), [expenses]);
            useEffect(() => localStorage.setItem('my_expense_locations', JSON.stringify(locations)), [locations]);
            useEffect(() => localStorage.setItem('my_expense_currency', currencySymbol), [currencySymbol]);
            useEffect(() => localStorage.setItem('my_gemini_api_key', userApiKey), [userApiKey]);
            useEffect(() => lucide.createIcons());

            const sortedExpenses = useMemo(() => {
                return [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            }, [expenses]);

            const totalAmount = useMemo(() => {
                return expenses.reduce((sum, e) => sum + (Number(e.amount) || 0), 0);
            }, [expenses]);

            const showNotify = (msg) => { 
                setNotification(msg); 
                setTimeout(() => setNotification(null), 3000); 
            };

            const isValidDate = (d) => {
                return d instanceof Date && !isNaN(d);
            };

            const formatAmount = (amt) => {
                const num = parseFloat(amt);
                return isNaN(num) ? "0.00" : num.toFixed(2);
            };

            const callGemini = async (prompt) => {
                if (!userApiKey) { setShowSettings(true); showNotify("⚠️ Set API Key in Settings first!"); return null; }
                if (!navigator.onLine) { showNotify("⚠️ No Internet Connection"); return null; }

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${userApiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    
                    if (!response.ok) throw new Error("API Request Failed");
                    
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Error";
                } catch (e) { 
                    console.error(e); 
                    showNotify("AI Service Unavailable. Check Key/Internet."); 
                    return "Error"; 
                }
            };

            const handleVoiceInput = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    return showNotify("Voice input not supported in this browser");
                }
                
                if (isListening) {
                    if (recognitionRef.current) recognitionRef.current.stop();
                    setIsListening(false);
                    return;
                }

                const recognition = new SpeechRecognition();
                recognitionRef.current = recognition;
                recognition.lang = 'en-US';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onstart = () => {
                    setIsListening(true);
                    showNotify("Listening...");
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setSmartInput(prev => prev ? prev + " " + transcript : transcript);
                    setIsListening(false);
                };

                recognition.onerror = (event) => {
                    console.error("Speech error", event.error);
                    setIsListening(false);
                    if (event.error === 'not-allowed') {
                        showNotify("Microphone access denied.");
                    } else {
                        showNotify("Voice Error: " + event.error);
                    }
                };

                recognition.onend = () => setIsListening(false);
                recognition.start();
            };

            const handleSmartAdd = async () => {
                if (!smartInput.trim()) return;
                setIsAiLoading(true);

                const prompt = `
                    Extract structured expense data from this text: "${smartInput}"
                    Current Date: ${new Date().toISOString().split('T')[0]}
                    Existing Locations: ${locations.join(', ')}
                    Target Currency: ${currencySymbol}
                    
                    Return ONLY raw JSON (no markdown fences) with these keys:
                    - name: (string) short description
                    - amount: (number) value only, no currency symbol
                    - date: (string) YYYY-MM-DD format
                    - location: (string) best match from existing or new short one
                `;

                const result = await callGemini(prompt);
                
                if (result && result !== "Error") {
                    try {
                        const jsonStart = result.indexOf('{');
                        const jsonEnd = result.lastIndexOf('}');
                        
                        if (jsonStart !== -1 && jsonEnd !== -1) {
                            const cleanJson = result.substring(jsonStart, jsonEnd + 1);
                            const data = JSON.parse(cleanJson);
                            
                            if (data.amount && !isNaN(parseFloat(data.amount))) {
                                const newExp = {
                                    id: Date.now(),
                                    name: data.name || "Unknown Expense",
                                    amount: parseFloat(data.amount),
                                    date: data.date || new Date().toISOString().split('T')[0],
                                    location: data.location || "Home"
                                };
                                
                                const existingLoc = locations.find(l => l.toLowerCase() === (data.location || "").toLowerCase());
                                if (!existingLoc && data.location) {
                                    setLocations(prev => [...prev, data.location]);
                                } else if (existingLoc) {
                                    newExp.location = existingLoc; 
                                }

                                setExpenses(prev => [...prev, newExp]);
                                setSmartInput("");
                                showNotify("✨ AI Added Expense!");
                            } else {
                                showNotify("Could not extract a valid amount.");
                            }
                        } else {
                            throw new Error("No JSON found");
                        }
                    } catch (e) {
                        console.error("Parsing error", e);
                        showNotify("Failed to understand input. Try manual entry.");
                    }
                }
                setIsAiLoading(false);
            };

            const handleAnalyze = async () => {
                if (!expenses.length) return showNotify("No data to analyze!");
                setShowAnalysis(true); setAnalysisResult(""); setIsAiLoading(true);
                
                const recentExpenses = expenses.slice(-50); 
                const dataStr = JSON.stringify(recentExpenses.map(e => ({n:e.name, a:e.amount, l:e.location})));
                
                const result = await callGemini(`Analyze these expenses (Currency: ${currencySymbol}): ${dataStr}. Provide summary, categories, and 1 tip. Use emojis. Markdown format.`);
                setAnalysisResult(result || "Analysis failed."); setIsAiLoading(false);
            };

            const addExpense = (e) => {
                e.preventDefault();
                if (!formData.name.trim() || !formData.amount) {
                    return showNotify("Please fill in Name and Amount");
                }
                
                const amount = parseFloat(formData.amount);
                if (isNaN(amount)) return showNotify("Invalid Amount");

                setExpenses(prev => [...prev, { 
                    id: Date.now(), 
                    ...formData, 
                    amount: amount 
                }]);
                
                setFormData(prev => ({ ...prev, name: '', amount: '' }));
                showNotify("Added!");
            };

            const deleteExpense = (id) => setExpenses(prev => prev.filter(e => e.id !== id));
            
            const addLocation = (e) => { 
                e.preventDefault(); 
                if(newLocationInput.trim()){ 
                    if (locations.some(l => l.toLowerCase() === newLocationInput.toLowerCase())) {
                        showNotify("Location already exists!");
                        return;
                    }
                    setLocations(prev => [...prev, newLocationInput.trim()]); 
                    setNewLocationInput(""); 
                }
            };
            
            const removeLocation = (loc) => {
                if (locations.length <= 1) return showNotify("Keep at least one location.");
                setLocations(prev => prev.filter(l => l !== loc));
                if (formData.location === loc) {
                    setFormData(prev => ({...prev, location: locations.find(l => l !== loc) || ""}));
                }
            };
            
            const downloadExcel = () => {
                if (!expenses.length) return showNotify("No data to export!");
                try {
                    const ws = XLSX.utils.json_to_sheet(expenses.map(e => ({ 
                        Date: e.date, 
                        Location: e.location, 
                        Name: e.name, 
                        Amount: e.amount 
                    })));
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Expenses");
                    XLSX.writeFile(wb, "Expense_Sheet.xlsx");
                    showNotify("Downloaded successfully!");
                } catch (e) {
                    console.error(e);
                    showNotify("Export failed.");
                }
            };

            if (showAnalysis) return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto shadow-2xl animate-fade-in">
                        <div className="flex justify-between mb-4 sticky top-0 bg-white pb-2 border-b">
                            <h2 className="text-xl font-bold flex gap-2 text-gray-800"><i data-lucide="sparkles" className="text-purple-600"></i> Insights</h2>
                            <button onClick={() => setShowAnalysis(false)} className="hover:bg-gray-100 p-1 rounded"><i data-lucide="x"></i></button>
                        </div>
                        {isAiLoading ? (
                            <div className="py-10 text-center">
                                <div className="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mx-auto mb-4"></div>
                                <p className="text-purple-600 animate-pulse font-medium">Analyzing your spending...</p>
                            </div>
                        ) : (
                            <div className="prose text-sm text-gray-700" dangerouslySetInnerHTML={{ __html: marked.parse(analysisResult) }}></div>
                        )}
                    </div>
                </div>
            );

            if (showSettings) return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl animate-fade-in">
                        <div className="flex justify-between mb-6">
                            <h2 className="font-bold text-xl text-gray-800 flex items-center gap-2"><i data-lucide="settings"></i> Settings</h2>
                            <button onClick={() => setShowSettings(false)} className="hover:bg-gray-100 p-1 rounded"><i data-lucide="x"></i></button>
                        </div>
                        
                        <div className="space-y-6">
                            <div>
                                <h3 className="font-semibold mb-2 text-sm text-gray-500 uppercase tracking-wide">Currency</h3>
                                <div className="flex gap-2">
                                    {['$', '€', '£', '₹', '¥'].map(s => (
                                        <button 
                                            key={s} 
                                            onClick={() => setCurrencySymbol(s)} 
                                            className={`w-10 h-10 rounded-lg border font-bold text-lg transition-all ${currencySymbol === s ? 'bg-green-600 text-white border-green-600 shadow-md' : 'bg-white text-gray-600 hover:bg-gray-50'}`}
                                        >
                                            {s}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-purple-50 p-3 rounded-lg border border-purple-100">
                                 <h3 className="font-semibold text-purple-900 text-sm mb-1 flex items-center gap-2"><i data-lucide="key" className="w-3 h-3"></i> Gemini API Key</h3>
                                 <input 
                                    type="password" 
                                    value={userApiKey} 
                                    onChange={e => setUserApiKey(e.target.value)} 
                                    placeholder="Paste API Key..."
                                    className="w-full border border-purple-200 p-2 rounded text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white" 
                                />
                                <p className="text-xs text-purple-500 mt-1">Required for Smart Add & Insights.</p>
                            </div>

                            <div>
                                <h3 className="font-semibold mb-2 text-sm text-gray-500 uppercase tracking-wide">Locations</h3>
                                <div className="flex flex-wrap gap-2 mb-3">
                                    {locations.map(l => (
                                        <span key={l} className="bg-blue-50 text-blue-700 border border-blue-100 px-2 py-1 rounded-md text-sm flex gap-1 items-center">
                                            {l} 
                                            <button onClick={() => removeLocation(l)} className="hover:text-red-500 ml-1"><i data-lucide="x" className="w-3 h-3"></i></button>
                                        </span>
                                    ))}
                                </div>
                                <form onSubmit={addLocation} className="flex gap-2">
                                    <input 
                                        value={newLocationInput} 
                                        onChange={e => setNewLocationInput(e.target.value)} 
                                        placeholder="Add new location..." 
                                        className="border p-2 flex-1 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none" 
                                    />
                                    <button className="bg-blue-600 text-white px-4 rounded text-sm hover:bg-blue-700 font-medium">Add</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            );

            if (isWidgetMode) return (
                <div className="h-screen w-screen bg-white p-4 flex flex-col overflow-hidden">
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <p className="text-xs text-gray-500 font-bold uppercase tracking-wider">Total Spent</p>
                            <p className="text-3xl font-bold text-green-600">{currencySymbol}{formatAmount(totalAmount)}</p>
                        </div>
                        <button onClick={() => setIsWidgetMode(false)} className="p-2 hover:bg-gray-100 rounded-full text-gray-500"><i data-lucide="maximize-2" className="w-5 h-5"></i></button>
                    </div>
                    
                    <form onSubmit={addExpense} className="flex flex-col gap-3">
                        <input className="border p-3 rounded-lg bg-gray-50 focus:bg-white focus:ring-2 focus:ring-green-500 outline-none transition-all" placeholder="Expense Name" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                        <div className="flex gap-2">
                            <select className="border p-3 rounded-lg w-1/3 bg-white text-sm" value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})}>
                                {locations.map(l => <option key={l} value={l}>{l}</option>)}
                            </select>
                            <input className="border p-3 rounded-lg w-1/3 text-sm" type="number" placeholder="0.00" value={formData.amount} onChange={e => setFormData({...formData, amount: e.target.value})} />
                            <button className="bg-green-600 text-white rounded-lg flex-1 flex justify-center items-center hover:bg-green-700 shadow-md active:scale-95 transition-all"><i data-lucide="plus"></i></button>
                        </div>
                    </form>
                    
                    {notification && (
                        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-900/90 text-white px-4 py-2 rounded-lg text-sm shadow-xl backdrop-blur-sm animate-fade-in">
                            {notification}
                        </div>
                    )}
                </div>
            );

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-5xl mx-auto">
                    <div className="bg-white rounded-xl shadow-xl overflow-hidden border border-gray-100">

                        <div className="bg-green-600 p-6 text-white flex justify-between items-center">
                            <h1 className="text-2xl font-bold flex gap-2 items-center"><i data-lucide="sheet" className="w-6 h-6"></i> Expense Tracker</h1>
                            <div className="flex items-center gap-3">
                                <div className="text-right hidden md:block mr-2">
                                    <p className="text-xs text-green-100 uppercase font-semibold">Total Spent</p>
                                    <p className="text-2xl font-bold">{currencySymbol}{formatAmount(totalAmount)}</p>
                                </div>
                                <button onClick={handleAnalyze} className="sparkle-btn px-4 py-2 rounded-lg text-white flex gap-2 items-center hover:opacity-90 transition-all shadow-lg font-medium text-sm">
                                    <i data-lucide="sparkles" className="w-4 h-4"></i> <span className="hidden sm:inline">Insights</span>
                                </button>
                                <button onClick={() => setShowSettings(true)} className="bg-green-700/50 hover:bg-green-700 p-2 rounded-lg transition-colors"><i data-lucide="settings" className="w-5 h-5"></i></button>
                                <button onClick={() => setIsWidgetMode(true)} className="bg-green-700/50 hover:bg-green-700 p-2 rounded-lg transition-colors"><i data-lucide="minimize-2" className="w-5 h-5"></i></button>
                            </div>
                        </div>
                        

                        <div className="p-6 bg-gray-50 border-b border-gray-200">

                            <div className="flex gap-6 mb-6 border-b border-gray-200">
                                <button 
                                    onClick={() => setShowSmartAdd(false)}
                                    className={`text-sm font-bold pb-3 px-1 transition-all border-b-2 ${!showSmartAdd ? 'text-green-600 border-green-600' : 'text-gray-400 border-transparent hover:text-gray-600'}`}
                                >
                                    Manual Entry
                                </button>
                                <button 
                                    onClick={() => setShowSmartAdd(true)}
                                    className={`text-sm font-bold pb-3 px-1 transition-all border-b-2 flex items-center gap-2 ${showSmartAdd ? 'text-purple-600 border-purple-600' : 'text-gray-400 border-transparent hover:text-gray-600'}`}
                                >
                                    <i data-lucide="wand-2" className="w-4 h-4"></i> Smart Add
                                </button>
                            </div>


                            {showSmartAdd ? (
                                <div className="animate-fade-in relative">
                                    <textarea
                                        value={smartInput}
                                        onChange={(e) => setSmartInput(e.target.value)}
                                        placeholder="Type or speak naturally: 'Lunch at McDonald's for 12 dollars today'..."
                                        className="w-full p-4 border border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:outline-none min-h-[120px] text-gray-700 pr-14 shadow-sm resize-none text-lg"
                                        disabled={isAiLoading}
                                    />
                                    

                                    <button 
                                        onClick={handleVoiceInput}
                                        disabled={isAiLoading}
                                        className={`absolute top-3 right-3 p-2 rounded-full transition-all ${isListening ? 'bg-red-500 text-white listening-pulse shadow-lg' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}`}
                                        title={isListening ? "Stop Listening" : "Start Voice Command"}
                                    >
                                        <i data-lucide={isListening ? "mic-off" : "mic"} className="w-5 h-5"></i>
                                    </button>

                                    <div className="flex justify-between items-center mt-3">
                                        <p className="text-xs text-gray-500 italic flex items-center gap-1">
                                            {isListening ? <span className="text-red-500 font-bold animate-pulse">● Recording...</span> : "AI auto-detects: Date, Amount, Name, Location"}
                                        </p>
                                        <button 
                                            onClick={handleSmartAdd}
                                            disabled={isAiLoading || !smartInput.trim()}
                                            className="sparkle-btn text-white px-6 py-2 rounded-lg font-bold shadow-md hover:shadow-lg transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            {isAiLoading ? "Processing..." : <><i data-lucide="wand-2" className="w-4 h-4"></i> Extract & Add</>}
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <form onSubmit={addExpense} className="flex flex-col md:flex-row gap-4 items-end animate-fade-in">
                                    <div className="w-full md:w-40">
                                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1 ml-1">Date</label>
                                        <input type="date" className="p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-green-500 outline-none shadow-sm" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} />
                                    </div>
                                    <div className="w-full md:w-48">
                                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1 ml-1">Location</label>
                                        <select className="p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-green-500 outline-none shadow-sm bg-white" value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})}>
                                            {locations.map(l => <option key={l} value={l}>{l}</option>)}
                                        </select>
                                    </div>
                                    <div className="flex-1 w-full">
                                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1 ml-1">Expense Name</label>
                                        <input type="text" placeholder="e.g. Grocery Shopping" className="p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-green-500 outline-none shadow-sm" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                                    </div>
                                    <div className="w-full md:w-32">
                                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1 ml-1">Amount</label>
                                        <input type="number" placeholder="0.00" step="0.01" className="p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-green-500 outline-none shadow-sm font-mono" value={formData.amount} onChange={e => setFormData({...formData, amount: e.target.value})} />
                                    </div>
                                    <button type="submit" className="bg-green-600 text-white px-8 py-3 rounded-lg font-bold w-full md:w-auto hover:bg-green-700 transition-all shadow-md active:scale-95 h-[50px] flex items-center justify-center gap-2">
                                        <i data-lucide="plus-circle" className="w-5 h-5"></i> Add
                                    </button>
                                </form>
                            )}
                        </div>


                        <div className="p-6">
                            <div className="overflow-x-auto rounded-lg border border-gray-200 shadow-sm max-h-[500px] overflow-y-auto no-scrollbar">
                                <table className="excel-grid w-full">
                                    <thead className="sticky top-0 shadow-sm z-10">
                                        <tr>
                                            <th className="w-32">Date</th>
                                            <th className="w-32">Location</th>
                                            <th>Expense Name</th>
                                            <th className="w-32 text-right">Amount</th>
                                            <th className="w-20 text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white">
                                        {sortedExpenses.map(e => (
                                            <tr key={e.id} className="group transition-colors">
                                                <td className="text-gray-600 text-sm font-mono">{e.date}</td>
                                                <td><span className="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs font-medium border border-gray-200">{e.location}</span></td>
                                                <td className="font-medium text-gray-800">{e.name}</td>
                                                <td className="text-right font-mono font-bold text-gray-700">{currencySymbol}{formatAmount(e.amount)}</td>
                                                <td className="text-center">
                                                    <button onClick={() => deleteExpense(e.id)} className="text-gray-400 hover:text-red-500 transition-colors p-1 rounded hover:bg-red-50"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                                </td>
                                            </tr>
                                        ))}
                                        {expenses.length === 0 && (
                                            <tr>
                                                <td colSpan="5" className="text-center py-12 text-gray-400 italic">
                                                    <div className="flex flex-col items-center gap-2">
                                                        <i data-lucide="clipboard-list" className="w-8 h-8 opacity-20"></i>
                                                        <p>No expenses recorded yet.</p>
                                                        <p className="text-sm opacity-60">Try adding one above!</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        )}
                                    </tbody>
                                </table>
                            </div>
                            

                            <div className="mt-6 pt-4 border-t border-gray-100 flex justify-between items-center text-sm text-gray-500">
                                <span>{expenses.length} records found</span>
                                <button onClick={downloadExcel} className="bg-white border-2 border-green-600 text-green-700 font-bold py-2 px-6 rounded-lg flex items-center gap-2 hover:bg-green-50 transition-colors">
                                    <i data-lucide="download" className="w-4 h-4"></i> Export to Excel
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    {notification && (
                        <div className="fixed bottom-6 right-6 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-2xl animate-bounce z-[60] flex items-center gap-3">
                            <i data-lucide="bell" className="w-4 h-4 text-green-400"></i>
                            {notification}
                        </div>
                    )}
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ExpenseTracker />);
    </script>
</body>
</html>